<div class="container-fluid">
  <div class="page-title">
    <h4 class="pull-left">Egresos</h4>
    <button class="pull-right btn btn-info" (click)="ModalEgreso.show()">
      <i class="ti-plus"></i> Agregar nuevo egreso</button>
    <!--<button class="pull-right btn btn-info" (click)="ModalIndicadores.show()">
      <i class="fa fa-area-chart"></i> Indicadores</button>-->
  </div>
  <div class="clearfix"></div>
  <div class="row">
      <div class="col-md-4">
          <div class="app-modal-body">
              <form #FormEgreso="ngForm">
                <div class="row mrg-top-35">
                  <div class="col-md-12">
                    <canvas baseChart height="150" [datasets]="lineChartData" [labels]="lineChartLabels" [options]="lineChartOptions" [colors]="lineChartColors"
                      [legend]="lineChartLegend" [chartType]="lineChartType"></canvas>
                  </div>
                </div>
              </form>
            </div>
      </div>
      <div class="col-md-8">
          <div class="card">
              <div class="card-block ">
                  <ngx-datatable
                  #table
                  class='data-table' 
                  [columnMode]="'force'"
                  [columns]="columns" 
                  [loadingIndicator] ="true"
                  [selectionType] = "'checkbox'" 
                  [headerHeight]="30"
                  [footerHeight]="30"
                  [rowHeight]="undefined"
                  [limit]="100"
                  [messages] = "{ loadingMessage:'Cargando Información', emptyMessage:'No Hay información Disponible', totalMessage: 'Total' }"
                  [rows]='rowsFilter'>
                  </ngx-datatable>
              </div>
          </div>
      </div>
      
    <!--<div class="col-md-12">
      <div class="widget card">
        <div class="card-block">
          <p>Nuestros Egresos</p>
          <div class="table-overflow">
            <table class="table table-hover table-sm table-striped">
              <thead>
                <tr>
                  <th style="width:150px;">Fecha</th>
                  <th>Funcionario</th>
                  <th>Grupo</th>
                  <th>Tercero</th>
                  <th>Moneda</th>
                  <th style="width:80px">Valor</th>
                  <th style="width:130px;"></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let Egreso of Egresos">
                  <td>{{Egreso.Fecha | date:"dd/MM/yy" }}</td>
                  <td>{{Egreso.Nombre_Funcio}}</td>
                  <td>{{Egreso.Grupo}}</td>
                  <td>{{Egreso.Tercero}}</td>
                  <td>{{Egreso.Moneda}}</td>
                  <td>{{Egreso.Valor | currency }}</td>
                  <td class="text-center">
                    <button class="btn btn-default btn-xs" type="button" style="margin:0;" (click)="VerEgreso(Egreso.Id_Egreso, ModalVerEgreso)">
                      <i class="ti-search"></i>
                    </button>
                    <button class="btn btn-default btn-xs" type="button" style="margin:0;" (click)="EditarEgreso(Egreso.Id_Egreso, ModalEditarEgreso)">
                      <i class="ti-pencil"></i>
                    </button>
                    <button class="btn btn-default btn-xs" type="button" style="margin:0;" [swal]="{title:'¿Está Seguro?',text : 'Se dispone a eliminar esta información, esta acción no se puede revertir' , type:'warning', showCancelButton: true, confirmButtonText: 'Si, Anular', cancelButtonText:'No, Dejame Comprobar!'}"
                      (confirm)="EliminarEgreso(Egreso.Id_Egreso)">
                      <i class="ti-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>-->
  </div>
</div>

<!--<app-modal-basic [dialogClass]="'modal-lg'" id="ModalIndicadores" #ModalIndicadores>
  <div class="app-modal-header">
    <h4>Indicadores</h4>
    <button type="button" class="close basic-close" (click)="ModalIndicadores.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <form #FormEgreso="ngForm">
      <div class="row mrg-top-35">
        <div class="col-md-12">
          <canvas baseChart height="150" [datasets]="lineChartData" [labels]="lineChartLabels" [options]="lineChartOptions" [colors]="lineChartColors"
            [legend]="lineChartLegend" [chartType]="lineChartType"></canvas>
        </div>
      </div>
    </form>
  </div>
</app-modal-basic>-->

<app-modal-basic [dialogClass]="'modal-lg'" id="ModalEgreso" #ModalEgreso>
  <div class="app-modal-header">
    <h4>Nuevo Egreso</h4>
    <button type="button" class="close basic-close" (click)="ModalEgreso.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body" style="max-height: calc(100vh - 210px); overflow-y: auto;">
    <form #FormEgreso="ngForm">
      <div class="col-md-4" hidden>
        <div class="form-group">
          <label>Identificación</label>
          <input name="Identificacion_Funcionario" type="text" class="form-control" ngModel="{{IdentificacionFuncionario}}">
        </div>
      </div>
      <div class="row">
        <div class="col-md-3">
          <div class="form-group">
            <label>Grupo</label>
            <select class="form-control" name="Id_Grupo" ngModel (change)="ListaTerceros($event.target.value)" [(ngModel)]="grupoDefault"
               (focusout)="boolGrupo = true" required #grupo="ngModel">
              <option value="">Seleccione un grupo</option>
              <option *ngFor="let Grupo of Grupos" value="{{Grupo.Id_Grupo}}">{{Grupo.Nombre}}</option>
            </select>
            <div *ngIf="grupo.value=='' && boolGrupo==true" style="color:red">Campo inválido</div>
            <div *ngIf="!grupo.value==''" style="color:green">Datos correctos!</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label>Tercero</label>
            <select class="form-control" name="Id_Tercero" ngModel [(ngModel)]="terceroDefault" (focusout)="boolTercero = true"
              required #tercero="ngModel">
              <option value="">Seleccione un tercero</option>
              <option *ngFor="let Tercero of Terceros" value="{{Tercero.Id_Tercero}}">{{Tercero.Nombre}}</option>
            </select>
            <div *ngIf="tercero.value=='' && boolTercero==true" style="color:red">Campo inválido</div>
            <div *ngIf="!tercero.value==''" style="color:green">Datos correctos!</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label>Moneda</label>
            <select class="form-control" name="Moneda" ngModel="" [(ngModel)]="monedaDefault" (focusout)="boolMoneda = true"
              required #moneda="ngModel">
              <option value="">Seleccione una moneda</option>
              <option *ngFor="let Moneda of Monedas" value="{{Moneda.Nombre}}">{{Moneda.Nombre}}</option>
            </select>
            <div *ngIf="moneda.value=='' && boolMoneda==true" style="color:red">Campo inválido</div>
            <div *ngIf="!moneda.value==''" style="color:green">Datos correctos!</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label>Valor</label>
            <input currencyMask name="Valor" ngModel=0 class="form-control" placeholder="Valor" [options]="{ prefix: '$ ', thousands: '.', decimal: ',' }"
              (focusout)="boolValor = true" required #valor="ngModel">
            <div *ngIf="!valor.valid && boolValor==true" style="color:red">Campo inválido</div>
            <div *ngIf="valor.valid && boolValor==true" style="color:green">Datos correctos!</div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <div class="form-group">
            <label>Detalles</label>
            <textarea class="form-control" placeholder="Detalles de Cuenta Bancaria" name="Detalle" ngModel></textarea>
          </div>
        </div>
      </div>
    </form>
  </div>
  <div class="app-modal-footer">
    <div class="text-right">
      <button type="submit" class="btn btn-primary" [disabled]="!valor.valid || grupo.value=='' || tercero.value=='' || moneda.value==''"
        [swal]="{title : '¿Está seguro?', text: 'Se dispone a guardar esta información' , type : 'warning', showCancelButton : true , confirmButtonText: 'Sí, Guardar',cancelButtonText: '¡No, déjame comprobar!'}"
        (confirm)="GuardarEgreso(FormEgreso, ModalEgreso)">Guardar Información</button>
    </div>
  </div>
</app-modal-basic>

<app-modal-basic [dialogClass]="'modal-lg'" id="ModalVerEgreso" #ModalVerEgreso>
  <div class="app-modal-header">
    <button type="button" class="close basic-close" (click)="ModalVerEgreso.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
    <h4>Ver Egreso</h4>
  </div>
  <div class="app-modal-body" style="max-height: calc(100vh - 210px); overflow-y: auto;">
    <form #FormVerEgreso="ngForm">
        <input name="id" readonly type="hidden" ngModel="{{Identificacion}}">
      <div class="row">
        <div class="col-md-3">
          <div class="form-group">
            <strong>
              <label>Grupo:</label>
            </strong>
            <span>{{Grupo}}</span>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <strong>
              <label>Tercero:</label>
            </strong>
            <span>{{Tercero}}</span>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <strong>
              <label>Moneda:</label>
            </strong>
            <span>{{Moneda}}</span>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <strong>
              <label>Valor:</label>
            </strong>
            <span>{{Valor}}</span>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <div class="form-group">
            <strong>
              <label>Detalles:</label>
            </strong>
            <span>{{Detalle}}</span>
          </div>
        </div>
      </div>
    </form>
  </div>
  <div class="app-modal-footer">
    <div class="text-right">
      <button type="button" class="btn btn-primary btn-sm" (click)="Cerrar(ModalVerEgreso)">Cerrar</button>
    </div>
  </div>
</app-modal-basic>

<app-modal-basic [dialogClass]="'modal-lg'" id="ModalEditarEgreso" #ModalEditarEgreso>
  <div class="app-modal-header">
    <button type="button" class="close basic-close" (click)="ModalEditarEgreso.hide()">
      <span aria-hidden="true">&times;</span>
    </button> 
    <h4>Editar Egreso</h4>
  </div>
  <div class="app-modal-body" style="max-height: calc(100vh - 210px); overflow-y: auto;">
    <form #FormEditarEgreso="ngForm">
      <div class="col-md-4" hidden>
        <div class="form-group">
          <label>Identificación</label>
          <input name="Id_Egreso" type="text" class="form-control" ngModel="{{Identificacion}}" required>
        </div>
      </div>
      <div class="col-md-4" hidden>
        <div class="form-group">
          <label>Identificación</label>
          <input name="Identificacion_Funcionario" type="text" class="form-control" ngModel="{{IdentificacionFuncionario}}"
            required>
        </div>
      </div>
      <div class="row">
        <div class="col-md-3">
          <div class="form-group">
            <label>Grupo</label>
            <select class="form-control" required name="Id_Grupo" [(ngModel)]="IdGrupo" (change)="ListaTerceros($event.target.value)"
               (focusout)="boolGrupo = true" required #grupoEd="ngModel">
              <option value="">Seleccione un grupo</option>
              <option *ngFor="let Grupo of Grupos" value="{{Grupo.Id_Grupo}}">{{Grupo.Nombre}}</option>
            </select>
            <div *ngIf="grupoEd.value=='' && boolGrupo==true" style="color:red">Campo inválido</div>
            <div *ngIf="!grupoEd.value==''" style="color:green">Datos correctos!</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label>Tercero</label>
            <select class="form-control" required name="Id_Tercero" [(ngModel)]="IdTercero"  (focusout)="boolTercero = true"
              required #terceroEd="ngModel">
              <option value="">Seleccione un tercero</option>
              <option *ngFor="let Tercero of Terceros" value="{{Tercero.Id_Tercero}}">{{Tercero.Nombre}}</option>
            </select>
            <div *ngIf="terceroEd.value=='' && boolTercero==true" style="color:red">Campo inválido</div>
            <div *ngIf="!terceroEd.value==''" style="color:green">Datos correctos!</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label>Moneda</label>
            <select class="form-control" required name="Moneda" [(ngModel)]="Moneda" (focusout)="boolMoneda = true"
              required #monedaEd="ngModel">
              <option value="">Seleccione una moneda</option>
              <option *ngFor="let Moneda of Monedas" value="{{Moneda.Nombre}}">{{Moneda.Nombre}}</option>
            </select>
            <div *ngIf="monedaEd.value=='' && boolMoneda==true" style="color:red">Campo inválido</div>
            <div *ngIf="!monedaEd.value==''" style="color:green">Datos correctos!</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label>Valor</label>
            <input currencyMask name="Valor" [(ngModel)]="Valor" class="form-control" placeholder="Valor" [options]="{ prefix: '$ ', thousands: '.', decimal: ',' }"
              (focus)="$event.target.select()" (focusout)="boolValor = true" required #valorEd="ngModel">
            <div *ngIf="!valorEd.valid && boolValor==true" style="color:red">Campo inválido</div>
            <div *ngIf="valorEd.valid && boolValor==true" style="color:green">Datos correctos!</div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <div class="form-group">
            <label>Detalles</label>
            <textarea class="form-control" placeholder="Detalles de Cuenta Bancaria" name="Detalle" [(ngModel)]="Detalle"></textarea>
          </div>
        </div>
      </div>
    </form>
  </div>
  <div class="app-modal-footer">
    <div class="text-right">
      <button type="button" class="btn btn-primary btn-sm" [disabled]="!valorEd.valid || grupoEd.value=='' || terceroEd.value=='' || monedaEd.value==''"
        [swal]="{title : '¿Está seguro?', text: 'Se dispone a actualizar esta información' , type : 'warning', showCancelButton : true , confirmButtonText: 'Sí, Actualizar',cancelButtonText: '¡No, déjame comprobar!'}"
        (confirm)="ActulizarEgreso(FormEditarEgreso, ModalEditarEgreso)">Actualizar Información</button>
    </div>
  </div> 
</app-modal-basic>

<ng-template #PlantillaBotones let-row="row" let-value="value">
    <div class="text-center">
        <button class="btn btn-default btn-xs" type="button" style="margin:0;" (click)="VerEgreso(value, ModalVerEgreso)">
            <i class="ti-search"></i>
          </button>
          <button class="btn btn-default btn-xs" type="button" style="margin:0;" (click)="EditarEgreso(value, ModalEditarEgreso)">
            <i class="ti-pencil"></i>
          </button>
          <button class="btn btn-default btn-xs" type="button" style="margin:0;" [swal]="{title:'¿Está Seguro?',text : 'Se dispone a eliminar esta información, esta acción no se puede revertir' , type:'warning', showCancelButton: true, confirmButtonText: 'Si, Anular', cancelButtonText:'No, Dejame Comprobar!'}"
            (confirm)="EliminarEgreso(value)">
            <i class="ti-trash"></i>
          </button>
    </div>
</ng-template> 

<swal #confirmacionSwal title="" text="" type=""></swal>

<swal #errorSwal title="Error al guardar" text="Se ha generado un error al intentar guardar la información" type="error">
</swal>

<swal #deleteSwal title="Traslado Anulado" text="Se ha anulado Correctamente la información" type="success">
</swal>